Current configuration:
{
    "concurrency_flag": false,
    "data_distribution": "iid",
    "dataset": "acl_dep_sad",
    "device": "cuda",
    "dp_delta": 0.003,
    "dp_epsilon": 10,
    "eval_batch_size": 4,
    "eval_flag": true,
    "eval_size": 0.2,
    "fed_alg": "fedavg",
    "layers": 3,
    "learning_rate": 0.0006,
    "max_length": 512,
    "ml_mode": "fl",
    "model": "bert_small",
    "model_name": "fl_10_seed2_acl_dep_sad",
    "models_path": "/local/vpaloma/fabric-federated-learning/ablation_study/phase-2/1-ml_mode-dataset-dp/acl_dep_sad",
    "mu": 0.5,
    "num_clients": 5,
    "num_epochs": 3,
    "num_rounds": 4,
    "optimizer": "AdamW",
    "progress_bar_flag": false,
    "save_model": true,
    "scheduler": "linear",
    "scheduler_warmup_steps": 0,
    "seed": 221,
    "test_flag": true,
    "train_batch_size": 4,
    "train_size": 0.8
}
-------- Configuration loaded --------

-------- Setting device --------
cuda device selected and available.
-------- Device set --------

-------- Setting seed --------
-------- Seed set --------

-------- Creating Model --------
-------- Model created --------

-------- Setting Trainable Layers --------
Training the last 3 layers.

Total parameters count: 28764674
Trainable parameters count: 3416066
-------- Trainable Layers set --------

-------- Creating Tokenizer --------
-------- Tokenizer created --------

-------- Creating Train and Eval Dataloaders --------
Train Loader: 2085 total sentences. 522 batches of size 4.
Eval Loader: 521 total sentences. 131 batches of size 4.
-------- Train and Eval Dataloaders created --------

-------- Training --------
Training with Federated Learning technology.
Training with differential privacy.
Federated averaging algorithm selected.
Client 0: Label 0: 225, Label 1: 192
Client 1: Label 0: 236, Label 1: 181
Client 2: Label 0: 259, Label 1: 158
Client 3: Label 0: 230, Label 1: 187
Client 4: Label 0: 261, Label 1: 156

Round 1 of 4
-------------------------------
Predictions - 1s: 29, 0s: 388
True Labels - 1s: 192, 0s: 225
Client 1 of 5: Local Epoch [1/3] Loss: 0.6997, Accuracy: 51.80 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 1, 0s: 416
True Labels - 1s: 192, 0s: 225
Client 1 of 5: Local Epoch [2/3] Loss: 0.7553, Accuracy: 54.20 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 192, 0s: 225
Client 1 of 5: Local Epoch [3/3] Loss: 0.8224, Accuracy: 53.96 %, Epsilon: 16.33, Delta: 0.0030
Predictions - 1s: 18, 0s: 399
True Labels - 1s: 181, 0s: 236
Client 2 of 5: Local Epoch [1/3] Loss: 0.7202, Accuracy: 56.59 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 181, 0s: 236
Client 2 of 5: Local Epoch [2/3] Loss: 0.9063, Accuracy: 56.59 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 181, 0s: 236
Client 2 of 5: Local Epoch [3/3] Loss: 1.0382, Accuracy: 56.59 %, Epsilon: 16.33, Delta: 0.0030
Predictions - 1s: 31, 0s: 386
True Labels - 1s: 158, 0s: 259
Client 3 of 5: Local Epoch [1/3] Loss: 0.7583, Accuracy: 59.47 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 158, 0s: 259
Client 3 of 5: Local Epoch [2/3] Loss: 1.0363, Accuracy: 62.11 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 158, 0s: 259
Client 3 of 5: Local Epoch [3/3] Loss: 1.1249, Accuracy: 62.11 %, Epsilon: 16.33, Delta: 0.0030
Predictions - 1s: 52, 0s: 365
True Labels - 1s: 187, 0s: 230
Client 4 of 5: Local Epoch [1/3] Loss: 0.6860, Accuracy: 53.24 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 187, 0s: 230
Client 4 of 5: Local Epoch [2/3] Loss: 0.7901, Accuracy: 55.16 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 187, 0s: 230
Client 4 of 5: Local Epoch [3/3] Loss: 0.8611, Accuracy: 55.16 %, Epsilon: 16.33, Delta: 0.0030
Predictions - 1s: 11, 0s: 406
True Labels - 1s: 156, 0s: 261
Client 5 of 5: Local Epoch [1/3] Loss: 0.7819, Accuracy: 61.39 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 156, 0s: 261
Client 5 of 5: Local Epoch [2/3] Loss: 1.0612, Accuracy: 62.59 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 156, 0s: 261
Client 5 of 5: Local Epoch [3/3] Loss: 1.1509, Accuracy: 62.59 %, Epsilon: 16.33, Delta: 0.0030
-------------------------------
Round [1/4] Average Local Loss: 0.9995, Average Local Accuracy: 58.08 %
-------------------------------
-------- Validation --------
Predictions - 1s: 0, 0s: 521
True Labels - 1s: 200, 0s: 321
Round [1/4] Global Model Validation Loss: 0.9558, Validation Accuracy: 61.61 %
-------- Validation finished --------
Updated best model in round 1 saved with Validation Loss: 0.9558 and Validation Accuracy: 61.61 %
-------------------------------

Round 2 of 4
-------------------------------
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 192, 0s: 225
Client 1 of 5: Local Epoch [1/3] Loss: 1.0888, Accuracy: 53.96 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 192, 0s: 225
Client 1 of 5: Local Epoch [2/3] Loss: 1.0901, Accuracy: 53.96 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 192, 0s: 225
Client 1 of 5: Local Epoch [3/3] Loss: 1.0908, Accuracy: 53.96 %, Epsilon: 16.33, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 181, 0s: 236
Client 2 of 5: Local Epoch [1/3] Loss: 1.1108, Accuracy: 56.59 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 181, 0s: 236
Client 2 of 5: Local Epoch [2/3] Loss: 1.1885, Accuracy: 56.59 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 181, 0s: 236
Client 2 of 5: Local Epoch [3/3] Loss: 1.0828, Accuracy: 56.59 %, Epsilon: 16.33, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 158, 0s: 259
Client 3 of 5: Local Epoch [1/3] Loss: 1.0917, Accuracy: 62.11 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 158, 0s: 259
Client 3 of 5: Local Epoch [2/3] Loss: 1.0821, Accuracy: 62.11 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 158, 0s: 259
Client 3 of 5: Local Epoch [3/3] Loss: 1.0412, Accuracy: 62.11 %, Epsilon: 16.33, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 187, 0s: 230
Client 4 of 5: Local Epoch [1/3] Loss: 1.1974, Accuracy: 55.16 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 187, 0s: 230
Client 4 of 5: Local Epoch [2/3] Loss: 1.0927, Accuracy: 55.16 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 187, 0s: 230
Client 4 of 5: Local Epoch [3/3] Loss: 1.0886, Accuracy: 55.16 %, Epsilon: 16.33, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 156, 0s: 261
Client 5 of 5: Local Epoch [1/3] Loss: 1.0518, Accuracy: 62.59 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 156, 0s: 261
Client 5 of 5: Local Epoch [2/3] Loss: 1.1324, Accuracy: 62.59 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 156, 0s: 261
Client 5 of 5: Local Epoch [3/3] Loss: 1.0932, Accuracy: 62.59 %, Epsilon: 16.33, Delta: 0.0030
-------------------------------
Round [2/4] Average Local Loss: 1.0793, Average Local Accuracy: 58.08 %
-------------------------------
-------- Validation --------
Predictions - 1s: 0, 0s: 521
True Labels - 1s: 200, 0s: 321
Round [2/4] Global Model Validation Loss: 1.0584, Validation Accuracy: 61.61 %
-------- Validation finished --------

Round 3 of 4
-------------------------------
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 192, 0s: 225
Client 1 of 5: Local Epoch [1/3] Loss: 1.1737, Accuracy: 53.96 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 192, 0s: 225
Client 1 of 5: Local Epoch [2/3] Loss: 0.9911, Accuracy: 53.96 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 1, 0s: 416
True Labels - 1s: 192, 0s: 225
Client 1 of 5: Local Epoch [3/3] Loss: 0.9210, Accuracy: 54.20 %, Epsilon: 16.33, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 181, 0s: 236
Client 2 of 5: Local Epoch [1/3] Loss: 1.0938, Accuracy: 56.59 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 181, 0s: 236
Client 2 of 5: Local Epoch [2/3] Loss: 0.9654, Accuracy: 56.59 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 181, 0s: 236
Client 2 of 5: Local Epoch [3/3] Loss: 0.9580, Accuracy: 56.59 %, Epsilon: 16.33, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 158, 0s: 259
Client 3 of 5: Local Epoch [1/3] Loss: 1.0290, Accuracy: 62.11 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 158, 0s: 259
Client 3 of 5: Local Epoch [2/3] Loss: 0.9430, Accuracy: 62.11 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 158, 0s: 259
Client 3 of 5: Local Epoch [3/3] Loss: 0.9255, Accuracy: 62.11 %, Epsilon: 16.33, Delta: 0.0030
Predictions - 1s: 1, 0s: 416
True Labels - 1s: 187, 0s: 230
Client 4 of 5: Local Epoch [1/3] Loss: 1.0079, Accuracy: 55.40 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 4, 0s: 413
True Labels - 1s: 187, 0s: 230
Client 4 of 5: Local Epoch [2/3] Loss: 0.8966, Accuracy: 56.12 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 8, 0s: 409
True Labels - 1s: 187, 0s: 230
Client 4 of 5: Local Epoch [3/3] Loss: 0.8613, Accuracy: 57.07 %, Epsilon: 16.33, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 156, 0s: 261
Client 5 of 5: Local Epoch [1/3] Loss: 1.0410, Accuracy: 62.59 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 156, 0s: 261
Client 5 of 5: Local Epoch [2/3] Loss: 0.9443, Accuracy: 62.59 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 156, 0s: 261
Client 5 of 5: Local Epoch [3/3] Loss: 0.9279, Accuracy: 62.59 %, Epsilon: 16.33, Delta: 0.0030
-------------------------------
Round [3/4] Average Local Loss: 0.9187, Average Local Accuracy: 58.51 %
-------------------------------
-------- Validation --------
Predictions - 1s: 0, 0s: 521
True Labels - 1s: 200, 0s: 321
Round [3/4] Global Model Validation Loss: 0.9127, Validation Accuracy: 61.61 %
-------- Validation finished --------
Updated best model in round 3 saved with Validation Loss: 0.9127 and Validation Accuracy: 61.61 %
-------------------------------

Round 4 of 4
-------------------------------
Predictions - 1s: 6, 0s: 411
True Labels - 1s: 192, 0s: 225
Client 1 of 5: Local Epoch [1/3] Loss: 0.9344, Accuracy: 55.40 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 28, 0s: 389
True Labels - 1s: 192, 0s: 225
Client 1 of 5: Local Epoch [2/3] Loss: 0.7677, Accuracy: 60.19 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 38, 0s: 379
True Labels - 1s: 192, 0s: 225
Client 1 of 5: Local Epoch [3/3] Loss: 0.7313, Accuracy: 62.59 %, Epsilon: 16.33, Delta: 0.0030
Predictions - 1s: 1, 0s: 416
True Labels - 1s: 181, 0s: 236
Client 2 of 5: Local Epoch [1/3] Loss: 0.8918, Accuracy: 56.83 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 8, 0s: 409
True Labels - 1s: 181, 0s: 236
Client 2 of 5: Local Epoch [2/3] Loss: 0.8274, Accuracy: 58.51 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 11, 0s: 406
True Labels - 1s: 181, 0s: 236
Client 2 of 5: Local Epoch [3/3] Loss: 0.7718, Accuracy: 59.23 %, Epsilon: 16.33, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 158, 0s: 259
Client 3 of 5: Local Epoch [1/3] Loss: 0.8833, Accuracy: 62.11 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 2, 0s: 415
True Labels - 1s: 158, 0s: 259
Client 3 of 5: Local Epoch [2/3] Loss: 0.8481, Accuracy: 62.59 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 4, 0s: 413
True Labels - 1s: 158, 0s: 259
Client 3 of 5: Local Epoch [3/3] Loss: 0.8267, Accuracy: 63.07 %, Epsilon: 16.33, Delta: 0.0030
Predictions - 1s: 5, 0s: 412
True Labels - 1s: 187, 0s: 230
Client 4 of 5: Local Epoch [1/3] Loss: 0.8566, Accuracy: 56.35 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 32, 0s: 385
True Labels - 1s: 187, 0s: 230
Client 4 of 5: Local Epoch [2/3] Loss: 0.7070, Accuracy: 62.35 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 42, 0s: 375
True Labels - 1s: 187, 0s: 230
Client 4 of 5: Local Epoch [3/3] Loss: 0.6526, Accuracy: 64.75 %, Epsilon: 16.33, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 156, 0s: 261
Client 5 of 5: Local Epoch [1/3] Loss: 0.9157, Accuracy: 62.59 %, Epsilon: 10.03, Delta: 0.0030
Predictions - 1s: 0, 0s: 417
True Labels - 1s: 156, 0s: 261
Client 5 of 5: Local Epoch [2/3] Loss: 0.8742, Accuracy: 62.59 %, Epsilon: 13.49, Delta: 0.0030
Predictions - 1s: 1, 0s: 416
True Labels - 1s: 156, 0s: 261
Client 5 of 5: Local Epoch [3/3] Loss: 0.8693, Accuracy: 62.83 %, Epsilon: 16.33, Delta: 0.0030
-------------------------------
Round [4/4] Average Local Loss: 0.7703, Average Local Accuracy: 62.49 %
-------------------------------
-------- Validation --------
Predictions - 1s: 16, 0s: 505
True Labels - 1s: 200, 0s: 321
Round [4/4] Global Model Validation Loss: 0.7532, Validation Accuracy: 64.68 %
-------- Validation finished --------
Updated best model in round 4 saved with Validation Loss: 0.7532 and Validation Accuracy: 64.68 %
-------------------------------
Best model in round 4 saved with Validation Loss: 0.7532 and Validation Accuracy: 64.68 %

-------- Training finished in 5:04 --------

Test flag enabled. Testing the model

-------- Loading best model from model_path --------
Loaded model bert-small from date 08-04-2024 21:05. Trained with Federated Learning technology.
Round 4, lr: 0.0006, optimizer: AdamW
Average train accuracy: 62.49 %, Validation accuracy: 64.68 %
-------- Best model loaded --------

-------- Creating Test Dataloader --------
Test Loader: 650 total sentences. 82 batches of size 8.
-------- Test Dataloader created --------

-------- Testing --------
Predictions - 1s: 19, 0s: 631
True Labels - 1s: 268, 0s: 382
Nº of test samples: 650
Accuracy: 61.69%
Accuracy 2 : 61.69%
Precision: 80.27%
Recall: 53.54%
F1 Score: 44.33%
Classification report:
              precision    recall  f1-score   support

           0     0.6054    1.0000    0.7542       382
           1     1.0000    0.0709    0.1324       268

    accuracy                         0.6169       650
   macro avg     0.8027    0.5354    0.4433       650
weighted avg     0.7681    0.6169    0.4978       650

-------- Testing finished --------
